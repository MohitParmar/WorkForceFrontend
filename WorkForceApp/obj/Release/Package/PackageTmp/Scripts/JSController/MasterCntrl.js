var app = angular.module('myApp', ['angularUtils.directives.dirPagination']);
app.controller('MasterController', function ($scope, $http, $filter) {
    $http.defaults.headers.common.Authorization = 'Basic ' + $('#myEmpUnqId').val(); $scope.currentPage = 1; $scope.itemsPerPage = 10; $scope.alluserlist = []; $scope._Conpath = ''; var url_string = window.location.href; var url = new URL(url_string); var urlhost = url.hostname; var urlprotocol = url.protocol; $(document).ready(function () { if (typeof (_ConPath) === "undefined") { return; } else { if (urlhost === _URLHostName) { $scope._Conpath = _ConPath; } else { $scope._Conpath = urlprotocol + "//" + urlhost + "/api/"; } }; });
    $scope.ResetView = function () { window.location.reload(true); };
    $scope.GetEmp = function (ecode) { var emp = new XMLHttpRequest(); if (ecode === '') { emp.open('GET', $scope._Conpath + 'GetEmployees?EmpUnqId=' + $('#myEmpUnqId').val(), true); } else { emp.open('GET', $scope._Conpath + 'GetEmployees?EmpUnqId=' + ecode, true); } emp.setRequestHeader('Accept', 'application/json'); emp.onreadystatechange = function () { if (emp.readyState === 4) { var json = JSON.parse(emp.responseText); $scope.empdata = json; $scope.$digest(); } }; emp.send(); };
    $scope.changePassword = function (entity) { var jsonObj = {}; jsonObj.userId = $('#myEmpUnqId').val(); jsonObj.Password = entity.Pass; jsonObj = JSON.stringify(jsonObj); var xhr2 = new XMLHttpRequest(); xhr2.open('POST', $scope._Conpath + 'ChangeUserPassword?curUser=' + $('#myEmpUnqId').val(), true); xhr2.setRequestHeader("Content-type", "application/json"); xhr2.onreadystatechange = function () { if (xhr2.readyState === 4 && xhr2.status === 200) { window.location.href = '/Login/UserLogin/'; } else if (xhr2.status === 400) { document.getElementById("MessageBox").innerHTML = "<div class='alert alert-danger alert-dismissable'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a><strong>Password Not Updated .. </strong></div>"; $('#MessageBox').show(); $('#eCode').val(''); $('#ePass').va(''); jQuery('#btnClose').click(); }; }; xhr2.send(jsonObj); };
    $scope.ResetPass = function (empcode) { if (typeof (empcode) === 'undefined') { document.getElementById("MessageBox").innerHTML = "<div class='alert alert-info alert-dismissable'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a><strong>Please Enter Employee Code...</strong></div>"; $('#MessageBox').show(); return false; }; var jsonObj = {}; jsonObj.userId = empcode; jsonObj.Password = empcode; jsonObj = JSON.stringify(jsonObj); var xhr2 = new XMLHttpRequest(); xhr2.open('POST', $scope._Conpath + 'ChangeUserPassword?curUser=' + $('#myEmpUnqId').val(), true); xhr2.setRequestHeader("Content-type", "application/json"); xhr2.onreadystatechange = function () { if (xhr2.readyState === 4 && xhr2.status === 200) { document.getElementById("MessageBox").innerHTML = "<div class='alert alert-success alert-dismissable'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a><strong>Password Changed Sucesfully..</strong></div>"; $('#MessageBox').show(); $('#eCode').val(''); $('#tbl_empdtl').hide(); } else if (xhr2.status === 400) { document.getElementById("MessageBox").innerHTML = "<div class='alert alert-danger alert-dismissable'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a><strong>Password Not Updated .. </strong></div>"; $('#MessageBox').show(); $('#eCode').val(''); $('#tbl_empdtl').hide(); }; }; xhr2.send(jsonObj); };
});